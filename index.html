<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Webpixels">
  <title>问卷调查</title>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700,800|Roboto:400,500,700" rel="stylesheet">
  <!-- Theme CSS -->
  <link type="text/css" href="./assets/css/theme.css" rel="stylesheet">
  <link type="text/css" href="./assets/css/demo.css" rel="stylesheet">
  <link href="./assets/css/index.css" rel="stylesheet">
</head>

<body>
  <main class="main">

    <section class="slice slice-lg">
      <div class="container">
        <div class="row justify-content-center">
          <div id="startBox" class="card text-center">
            <div class="card-header">
              <h4>Questionnaire</h4>
            </div>
            <div class="card-body text-center">
              <h5 class="card-title mb-4"></h5>
              <p class="card-text mb-4">This questionnaire is mainly to understand your views and understanding of relevant aspects</p>
              <img style="width: 250px;height: 250px;" src="/assets/images/Untitled.svg" alt="">
            </div>
            <div class="card-footer text-muted">
              <a href="javascript:;" id="startBtn" class="btn btn-primary">Start</a>
            </div>
          </div>
          <div class="row-wrapper col-lg-10">
            <div class="row cols-xs-space cols-sm-space cols-md-space">
              <div class="col-lg-12">
                <div id="questionnaire">
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

  </main>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script>
    $(document).ready(function () {
      $.getJSON('/json/questions.json', function (data) {
        // 生成问卷内容
        data.forEach((q, index) => {
          const questionHtml = `
                  <div class="card text-center question-card" data-index="${index}" style="display:none">
                    <div class="card-header">
                      <h4>${index + 1}. ${q.question}</h4>
                    </div>
                    <div class="card-body">
                       ${q.options.map((option, idx) => `
                      <div class="radio_box custom-control custom-radio mb-3">
                          <input class="custom-control-input" type="radio" name="question${index}" value="${option}" id="${index}${idx}">
                          <label class="radio_label custom-control-label" for="${index}${idx}">
                              ${option}
                          </label>
                      </div>
                    `).join('')}
                    <div class="card-footer text-muted">
                      <div class="btn-toolbar justify-content-between" role="toolbar">
                        <div class="btn-group" role="group" aria-label="First group">
                          <span href="javascript:;" class="btn btn-outline-secondary backBtn">Back</span>
                        </div>
                        <div class="input-group">
                          <span href="javascript:;" class="btn btn-primary nextBtn" ${index === data.length - 1 ? 'id="submitBtn"' : ''}>
                            ${index === data.length - 1 ? 'Submit' : 'Next'}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
              `;
          $('#questionnaire').append(questionHtml);
        });

        // 点击Start按钮后，开始问卷
        $('#startBtn').click(function () {
          $('#startBox').hide();
          startQuestionnaire();
        });

        function startQuestionnaire() {
          // 显示第一题
          $('.question-card').hide();
          $('.question-card').first().show();

          // 监听Next按钮点击事件
          $('.nextBtn').click(function () {
            const currentCard = $(this).closest('.question-card');
            const nextCard = currentCard.next('.question-card');
            const selectedOption = currentCard.find('input[type="radio"]:checked').val();

            if (selectedOption) {
              currentCard.hide();
              if (nextCard.length > 0) {
                nextCard.show();
              } else {
                $('#submitBtn').click();
              }
            }
          });

          // 监听Back按钮点击事件
          $('.backBtn').click(function () {
            const currentCard = $(this).closest('.question-card');
            const prevCard = currentCard.prev('.question-card');
            if (prevCard.length > 0) {
              currentCard.siblings().hide(); // 隐藏所有兄弟元素
              prevCard.show(); // 显示上一个兄弟元素
            }
          });

          // 自动选择随机选项并点击Next按钮
          let selectTimer = null;
          let nextTimer = null;

          function autoSelectOptionAndNext(index) {
            if (index < data.length) {
              const currentCard = $(`.question-card[data-index="${index}"]`);
              currentCard.show();

              // 清除之前的定时器
              if (selectTimer) clearTimeout(selectTimer);
              if (nextTimer) clearTimeout(nextTimer);

              selectTimer = setTimeout(() => {
                const options = $(`input[name="question${index}"]`);
                const randomOptionIndex = Math.floor(Math.random() * options.length);
                options.eq(randomOptionIndex).prop('checked', true);

                // 增加延迟点击Next按钮
                nextTimer = setTimeout(() => {
                  $(`.question-card[data-index="${index}"] .nextBtn`).click();
                }, 1500); // 点击Next按钮的延迟

              }, 1500); // 增加延迟时间选择选项
            }
          }

          let currentIndex = 0;
          const timer = setInterval(function () {
            autoSelectOptionAndNext(currentIndex);
            currentIndex++;
            if (currentIndex >= data.length) {
              clearInterval(timer);
            }
          }, 4000); // 控制总间隔时间4秒，包含显示、选择和点击的延迟
        }

        $('#submitBtn').click(function () {
          // 处理提交的答案
          window.location.href = 'success.html'
        });
      });
    });
  </script>
</body>

</html>
